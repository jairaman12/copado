<!-- 
    Apttus Contract Management
    OfflineAgreementNew
     
    @2009-2018 Apttus Inc. All rights reserved.

 -->
<apex:page controller="Apttus.OfflineAgreementNewController" >
    <apex:variable var="isLightning" value="{!$User.UIThemeDisplayed == 'Theme4d'}"  />
    <apex:variable var="isSalesforce1" value="{!$User.UIThemeDisplayed == 'Theme4t'}" />
    
     <apex:variable var="isIncludecss" value="{!isLightning  || isSalesforce1 }" 
                   rendered="{!isLightning || isSalesforce1}">
        <apex:stylesheet value="{!URLFOR($Resource.Apttus__LightningResource, 'css/agreement-clone-styling.css')}" />
        <apex:stylesheet value="{!URLFOR($Resource.Apttus__SLDS080, 'assets/styles/salesforce-lightning-design-system-vf.css')}" />
        <style>
            html body.sfdcBody {
            padding:0 0 0 0;
            }
            
            slds .slds-page-header {
             padding: 24px 24px 12px; 
             border-bottom: 0px solid #d8dde6; */
             background: #f4f6f9; 
            }
            body .bPageBlock .detailList tr td, body .bPageBlock .detailList tr th, body table.list tr td, body table.list tr th, body .hoverDetail .bPageBlock .detailList tr td, body .hoverDetail .bPageBlock .detailList tr th{
                border-color:#f4f6f9;
            }
            body .bPageBlock, body #bodyCell .bResource .secondaryPalette, body .secondaryPalette.bPageBlock, body .individualPalette .secondaryPalette.bPageBlock, body .bodyDiv .genericTable, body .genericPageBlockTable, body .bodyDiv .bSubBlock, body .bComponentBlock .bPageBlock, body .bMyDashboard .bPageBlock, body.rlHoverFrame .bPageBlock, body.subjectSelectionPopup div.choicesBox, body.lookupTab .secondaryPalette.bPageBlock, body.popupTab .secondaryPalette.bPageBlock, body.UserTagStatsPage .secondaryPalette.bPageBlock{
                border-color:#f4f6f9;
                border-bottom:#f4f6f9;
                border-left:#f4f6f9;
                border-right:#f4f6f9;
            }            
        </style>
    </apex:variable>
    <script language="Javascript">
        
        function SubmitOnClick (objSubmitBtn) {
             var isFirefox = typeof InstallTrigger !== 'undefined';
             var isChrome = !!window.chrome && !!window.chrome.webstore;
             
             if(isFirefox == true){
                 objSubmitBtn.className = 'btnDisabled';
             }
             else if(isChrome == true){
                 objSubmitBtn.disabled = true;
                 objSubmitBtn.className = 'btnDisabled';
                 doSubmit();
             }
             else{
                 objSubmitBtn.className = 'btnDisabled';
             }
            return true;
        }
        
     /**
      *	handle change in import checkbox, Disable Continue Button
      **/
    function onChangeImportOffline() {
        var continueButtons = document.getElementsByClassName("continueButton");
        continueButtons[0].disabled = true;
    }

    </script>       
    
    
    
    <apex:form id="attachForm">
        
        <apex:pageBlock rendered="{!NOT(isInitialized) && NOT(hasErrors)}">
             
                <apex:pageBlockButtons location="bottom" rendered="{!NOT(isLightning || isSalesforce1)}" >
                    <apex:commandButton value="{!$Label.apttus__continue}" onclick="return SubmitOnClick(this);" action="{!init}" />
                    <apex:commandButton value="{!$Label.apttus__cancel}" action="{!doCancel}" immediate="true" />
                </apex:pageBlockButtons>
                <apex:pageBlockSection title="{!$Label.apttus__newofflineagreement}" columns="2" collapsible="false" rendered="{!NOT(isLightning || isSalesforce1)}">
                    <apex:outputField value="{!AgreementSO.Name}"/>
                    <apex:outputField value="{!AgreementSO.Apttus__Status_Category__c}"/>
                </apex:pageBlockSection>

            <apex:outputPanel rendered="{!isLightning || isSalesforce1}">
                <!-- Lightning View -->
                <div class="slds" width="95%">
                    <div class="slds-wrap"> 
                        <div class="slds-page-header" role="banner">
                            <div> 
                                <div class="slds-wrap"><apex:sectionHeader title="{!$Label.apttus__createofflineagreement}" subtitle="{!$Label.apttus__attachagreement}" /></div>
                                <div  class="slds-wrap"> 
                                    <apex:pageBlock rendered="{!NOT(isInitialized) && NOT(hasErrors)}" >
                                        <apex:pageBlockSection columns="{!if(isSalesforce1,1,2)}" collapsible="false" >
                                            <apex:outputField value="{!AgreementSO.Name}"/>
                                            <apex:outputField value="{!AgreementSO.Apttus__Status_Category__c}"/>
                                        </apex:pageBlockSection>
                                    </apex:pageBlock>
                                </div>
                                
                                <div  class="slds-wrap">
                                    <div class="slds-page-header">
                                        <div class="slds-grid"> 
                                            <div class="slds-col"></div>
                                            <div class="slds-grid slds-grid_align-end">
                                                <apex:commandButton styleclass="slds-button slds-button--neutral"  value="{!$Label.apttus__cancel}"  action="{!doCancel}" />
                                                &nbsp;
                                                <apex:commandButton styleclass="slds-button slds-button--brand" onclick="return SubmitOnClick(this);" value="{!$Label.apttus__continue}" action="{!init}"/>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div> 
                </div>
            </apex:outputPanel>
        </apex:pageBlock>
        
        <apex:pageBlock mode="edit" rendered="{!hasErrors}" >
            <apex:pageMessages />
            <apex:pageBlockButtons location="bottom" >
                <apex:commandButton action="{!doReturn}" value="{!$Label.apttus__cancel}" immediate="true"/>
            </apex:pageBlockButtons>
        </apex:pageBlock>
    
        <apex:pageBlock mode="edit" rendered="{!isInitialized && NOT(hasErrors)}">
            <apex:pageMessages />
            <apex:pageBlockButtons location="bottom" >
                <apex:commandButton action="{!doContinue}" value="{!$Label.apttus__continue}" disabled="{!countOfAttachments <= 0}" styleClass="continueButton" />
                <apex:commandButton action="{!doCancel}" value="{!$Label.apttus__cancel}" immediate="true"/>
            </apex:pageBlockButtons>
            <apex:outputPanel id="upload">
                <!-- display Select File --> 
                <apex:outputText style="font-weight: bold" value="{!'1. ' & $Label.apttus__selectfile}" /><br/>
                <apex:outputText value="{!$Label.apttus__selectfileinstruction}" /> <p/>
                <apex:inputFile size="80" value="{!filebody}" fileName="{!fileName}" contentType="{!contentType}" /><p/>
                <apex:outputText value="{!uploadErrorMsg}" style="font-weight: bold; color: red" /><p/>
                <apex:outputText style="font-weight: bold" value="{!'2. ' & $Label.apttus__clickattachfile}" escape="true" /> <br/>
                <apex:outputText value="{!$Label.apttus__createofflineagreementinstruction}" /> <p/>
                <apex:commandButton value="{!$Label.apttus__attachfile}" action="{!doAttach}" /> <p/>
                <!-- Display Intelligent Import Option if Applicable -->
                <apex:outputPanel rendered="{!isIntelligentImportSupported}" id="IntelligentImport">
                    <apex:outputText style="font-weight: bold" value="{!'3.' & $Label.apttus__intelligentimportinstruction}" escape="true" /> <br/>
                    <apex:outputText value="{!$Label.apttus__intelligentimport}"> </apex:outputText>
                    <apex:inputCheckbox value="{!intelligentImport}" onchange="doChangeIntelligentImport()"/> <p/>
                </apex:outputPanel>
                
            </apex:outputPanel>
            <!-- Display List of Attachments --> 
            <apex:outputPanel id="status">
                <p>{!$Label.apttus__filesuploaded}</p>
                <apex:dataList type="square" value="{!attachments}" var="item" rows="6" >
                    <apex:outputText value="{!item.Name}"/>
                </apex:dataList>
            </apex:outputPanel>
            <!-- Display Intelligent Import Note  -->
            <apex:outputPanel rendered="{!isIntelligentImportSupported}" id="intelligentImportNote">
                <br/>
                	<apex:outputText value="{!$Label.apttus__intelligentimportnote}" />
                <br/>
            </apex:outputPanel>
            
            <!-- Display Logo with powered by -->
            <apex:outputPanel rendered="{!isIntelligentImportSupported && intelligentImportLogo != null}" id="intelligentImportLogo">
                <br/>
                <apex:outputText value="{!$Label.apttus__poweredbyide}" />
                <img id="theImage" src="{!intelligentImportLogo}" height="25" maxheight="50" alt="Logo of IDE Provider"/>
                <br/>
            </apex:outputPanel>
        </apex:pageBlock>
        
        <apex:actionFunction name="doSubmit" action="{!init}" />
        <apex:actionFunction name="doChangeIntelligentImport" action="{!doChangeIntelligentImport}" />
        
    </apex:form>
    
</apex:page>